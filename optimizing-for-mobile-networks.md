# 优化移动网络
首先，通过 Keepalive 连接，使服务器距客户端更近，优化 TLS 部署，以及我们所涵盖的所有其他协议优化来降低延迟在移动应用中显的更为重要，延迟和吞吐量总是值得优化的。同样的，所有 Web 应用性能最佳实践同样适用。向前翻翻[优化 Web 性能](https://hpbn.co/primer-on-web-performance/)。

然而，移动网络对于性能优化也有一些新的独特的要求。设计移动应用需要仔细规划和考虑设备形式对内容呈现的限制，无线接口独特的性能特性，电池寿命的影响。这三个是不可分割的。

也许是因为有着诸如响应式布局的表示层最容易控制，它往往受到最多的关注。然而，大多数应用的不足通常是由于对网络性能的不正确的设计假设：应用协议是相同的，但物理传递层之间的差异强加了一些限制，如果不明白这些将导致缓慢的响应时间，延迟变化巨大，最终为用户带来较差的体验。糟糕的网络决策也将对设备的电池寿命产生极大的负面影响。

这三个限制没有通用的解决方案。表示层，网络和电池寿命表现都有最佳实践，但经常出现问题。这取决于您，并需要在需求中找到平衡。可以肯定的是：简单地忽略其中的任何一个因素都不会让你走的很远。

考虑到这一点，我们不会对表示层做过多阐述，因为每个平台和应用类型都有所不同，现在有许多专门针对这个问题的书籍。但是，无论制造商或操作系统如何，移动网络对于无线电和电池限制是统一的，这就是本章重点。

**note**
在本章中，“移动应用”具有其最广泛的定义：我们关于移动网络性能的所有讨论同样适用于所有原生应用以及运行在所有浏览器中的应用。

# 节省电池能源
涉及移动领域，节能是所有人关注的问题：设备制造商，运营商，应用程序开发人员以及我们应用的最终用户。当产生疑问时，或者想弄清楚为什么会有某种行为时，请问一个简单的问题：它将如何影响或改善电池寿命？事实上，这是一个很好的问题，同样审视一下你的应用中的每一功能。

移动网络的性能本质上与电池性能相关。实际上为了优化电池寿命，无线接口的物理层是专门根据如下限制特殊构建的。

1. 全功率的无线电使用可能会在数小时内耗尽电池。
2. 每一代无线电发展都会提高无线电功率的要求。
3. 无线电的功耗通常仅次于屏幕。
4. 无线电的使用相对于传输的数据量通常是非线性的。

考虑到这一点，移动应用应该旨在尽量减少对无线接口的使用。要明确的是，这并不是说你应该避免完全使用天线;毕竟我们正在构建依赖于网络连接的应用！然而，因为保持天线激活的功耗很高，所以我们的应用应该在天线激活时最大限度地传输数据，然后寻求最小化额外数据传输。

**note**
虽然 WiFi 也使用无线接口传输数据，由于 WiFi 的底层机制的不同，认识到 WiFi 与2G，3G 和 4G 移动网络在延迟，吞吐和功率配置基本上的差异是十分重要的;请参阅我们之前的讨论 [3G, 4G, 和 WiFi 的功耗要求](https://hpbn.co/mobile-networks/#3g-4g-and-wifi-power-requirements)。因此，WiFi 与移动网络的网络行为应该通常认为是不同的。

>**使用 AT&T 应用资源优化器测量电源使用**
>优化电源使用受到了高度重视，但大多数平台目前仍然缺乏帮助开发人员测量和优化其应用的必要工具。幸运的是，有第三方工具可以提供帮助，例如由 AT&T 开发的免费的应用资源优化器（ARO）工具包。
>
>ARO 由两个组件组成：收集器和分析仪。收集器是在后台运行的 Android 应用（在真实手机或模拟器中），并捕获传输的数据包，无线电活动以及与手机的其他交互。加载收集器，点击 Record，与应用进行一些交互，便可以捕获跟踪结果，最后将跟踪结果复制到系统。
>
>一旦有了跟踪结果，您可以使用分析仪打开它，以了解应用程序的无线状态，能源消耗和流量模式。分析仪的一个重要功能是它针对常见的性能缺陷提供建议，例如缺少压缩，数据传输冗余等。
>
>两个重要的事情值得注意：电池消耗和无线电状态是通过指定的设备型号和无线网络的类型生成的。换句话说，生成的数字不是来自正在使用的设备的精确测量值，而是基于模型中指定参数的产生估计值。这允许您导入不同的设备和网络模型并比较其能源使用 - 例如 3G 与 4G。
>
>最后，收集器只能在 Android 平台上使用，但是 ARO 分析器也可以接受 **tcpdump** 或其他兼容工具生成的任何常规数据包跟踪文件（pcap）; iOS 用户必须使用 **tcpdump** 方法。
>
>可以在 [https://hpbn.co/attaro](https://hpbn.co/attaro) 获取 ARO。

![8-1](assets/2017-08-03-23-07-43.png)

图 8-1  AT&T 应用资源优化器
