# 移动网络
截至 2013 年初，全球约有 64 亿个蜂窝网络连接。仅在 2012 年，IDC 市场情报报告显示智能手机，平板电脑，笔记本电脑，个人电脑等智能连接设备的出货量估计为 11 亿美元。更为值得注意的是今后几年的高速增长预测：同一个 IDC报告预测 2016 年新设备出货量将攀升至 18 亿以上，其他报告预测到 2020 年总共超过 200 亿台连接设备。

预计 2012 年人口将达70亿，2020 年将达到 75 亿，这些趋势说明了我们对智能连接设备的需求：显然，我们大多数人不满足只有一个设备。

然而，连接设备的绝对数量只是整个故事的一小部分。高速连接设备无休止的增长暗示着无处不在的连接需要适配所有的新设备。这就是为什么我们必须将话题转移到各种移动电话技术上，例如 GSM，CDMA，HSPA 以及 LTE。很可能的情况是，大多数用户将使用这些技术之一，一些专门用于访问您的网站或服务。需要的投入很多，但是我们必须做到这一点，移动网络肯定会有一系列性能挑战。

# “G” 的历史简述
弄清楚各种各种移动通信技术标准，发布版本以及对应的优缺点，不止会占用这一章，而是整本书。这里，我们的目标很简单，我们需要了解市场上占据主要地位的无线技术，表7-1 中列出里程碑式的版本对应的参数及其影响。

版本|峰值速率|描述
---|-------|---
1G|无法传输数据|模拟系统
2G|Kbit/s|第一个与模拟系统并行的数字系统
3G|Mbit/s|与模拟系统并行部署的专用数字网络
4G|Gbit/s|数字化且只能传输数据包网络

表7-1  各个版本的移动通讯技术


第一个需要理解的是每个无线电的基本标准都以峰值频谱效率（bps / Hz）表示，然后将其转换为便于记忆的数字，例如4G网络的 Gbit/s+ 峰值数据速率。然而，你现在应该认识到前一句话中的关键词：峰值！回顾我们早前关于[测量现实世界无线性能](https://hpbn.co/introduction-to-wireless-networks/#measuring-real-world-wireless-performance)的讨论，峰值数据速率是在理想条件下实现的。

无论标准如何，每个网络的实际性能将由供应商，网络配置，给定单元中的活动用户数，特定位置的无线电环境，正在使用的设备以及所有其他因素影响。考虑到这一点，虽然在现实世界环境中不保证数据速率，但是一个简单但有效的校准性能预期的策略（表7-2）是假设数据吞吐量的下限与延迟的上限。

版本|数据速率|延迟
--|--|--
2G|100-400Kbit/s|300-1000ms
3G|0.5-5Mbit/s|100-500ms
4G|1-50Mbit/s|<100ms

表7-2 活跃网络连接的数据速率和延迟

更复杂的是，任何给定网络的分类如 3G 或 4G 都太过粗糙，预期的吞吐量和延迟也只是大致预估。为了理解为什么是这样的情况，以及行业的前进方向在哪里，我们首先需要快速调查不同技术的历史和发展背后的关键角色。

## 第一代数据服务 2G
1G 网络在 1979 年于日本第一次投入商用。它是一个模拟系统，不提供任何数据传输服务。在 1991 年，第一个基于 GSM（全球移动通信系统）2G 网络登陆芬兰，它将数字信号引入了无线电网络，开启第一个电路交换移动数据业务，例如文本消息（SMS），和以 9.6Kbit/s 峰值速率的数据包传递服务！

直到 20 世纪 90 年代中期，当通用分组无线业务（GPRS）首次被引入到GSM标准时，无线因特网的接入开始成为现实，尽管它仍然非常缓慢：使用 GPRS，现在可以达到 172 Kbit/s，典型的往返延迟在高达数百毫秒。GPRS 和早期 2G 语音技术的组合通常被描述为 2.5G。几年后，EDGE（GSM 增强数据速率进化版）增强了这些网络，将峰值数据速率提高到 384 Kbit/s。第一个EDGE 网络（2.75G）于 2003 年在美国推出。

在这一点上，停下脚步进行反思是必要的。无线通信已经有数十年的历史了，但实际的，面向消费者的移动网络数据服务是近来的现象！2.75G 网络只有十年之久，但是也已经在全球广泛应用。然而，我们大多数人现在根本无法想象没有高速无线接入的生活。无线技术的演进和使用率已经不再令人吃惊。

## 3GPP 与 3GPP2 之间的合作
一旦消费者对无线数据业务的需求开始增长，无线电网络的交互性问题成为所有参与者的热点问题。一方面，电信提供商必须购买和部署用于无线电接入网络（RAN）的硬件，这需要投入大量资本并长期维护-标准化硬件意味着降低成本。类似地，没有行业标准，用户将被限制在他们的家庭网络中，限制了移动数据访问的使用场景和便利性。

作为回应，欧洲电信标准研究所（ETSI）在 20 世纪 90 年代初制定了 GSM 标准，许多欧洲国家和全球迅速采用。事实上，GSM 仍旧是部署最广泛的无线标准，据估计，覆盖了市场份额的 80％-85％（图7-1）。但并不是唯一的一个。同时，高通公司开发的 IS-95 标准也占据了 10％-15％ 的市场份额，其中最着名的是许多横跨北美的网络部署。因此，为 IS-95 无线电网络设计的设备不能在 GSM 网络上运行，反之亦然 - 这是许多国际旅客熟悉的糟糕体验。

![7-1](assets/2017-05-31-12-27-12.png)

图 7-1 2003-2007 年之间移动网络的市场份额

1998 年时，由于认识到部署标准的全球演进以及下一代（3G）网络的需求，GSM 和 IS-95 标准组织的参与者组成了两个全球合作项目：

*第三代合作伙伴计划（3GPP）*

负责开发通用移动电信系统（UMTS），这是 GSM 网络的 3G 演进。后来又进行了 GSM 标准的维护和新的 LTE 标准的制定。

*第三代合作伙伴计划2（3GPP2）*
负责开发基于 CDMA2000 技术的 3G 规范，该技术是高通公司开发的 IS-95 标准的后继产品。

因此，两种类型的标准（表7-3）和相关网络基础设施的开发已经同时进行。也许并没有完全步伐一致，但是基本技术大体相似。

---|---|---
版本|组织|发布
2G | 3GPP | GSM
2G | 3GPP2 | IS-95 (cdmaOne)
2.5G, 2.75G | 3GPP | GPRS, EDGE (EGPRS)
2.5G, 2.75G | 3GPP2 | CDMA2000
3G | 3GPP | UMTS
3G | 3GPP2 | CDMA 2000 1x EV-DO Release 0
3.5G, 3.75G, 3.9G | 3GPP | HSPA, HSPA+, LTE
3.5G, 3.75G, 3.9G | 3GPP2 | EV-DO Revision A, EV-DO Revision B, EV-DO Advanced
4G | 3GPP | LTE-Advanced, HSPA+ Revision 11+

表 7-3 3GPP 和 3GPP2 开发的移动网络标准

您很有可能在列表中看到一些熟悉的标签：EV-DO，HSPA，LTE。许多网络运营商已经投入了大量的营销资源，并将继续下去，将这些技术推广为“最新最快的移动数据网络”。然而，我们的兴趣和这种历史绕行的原因不在于营销，而是宏观观察移动无线产业演进：

1. 世界范围内有两种部署完毕，占据主导地位的移动网络类型
2. 3GPP 和 3GPP2 为每种技术的演进做出规划
3. 3GPP 和 3GPP2 标准并不能在不同设备间兼容

并没有 4G 或 3G 技术。国际电信联盟（ITU）为每一代无线技术制定了国际标准和性能特征，例如数据速率和延迟，3GPP 和 3GPP2 组织在其各自技术的背景下满足并超越了这些标准的期望。

**note**

> 您如何查询运营商使用哪种网络类型？这很简单。你的手机有 SIM 卡吗？如果有的话，那么它是从 GSM 演进而来的 3GPP 技术。要了解有关网络的更多详细信息，请查看运营商的常见问题解答，或者如果手机允许，请直接在手机上查看网络信息。

对于 Android 用户，打开手机拨号屏幕并输入：\*＃\*＃4636＃\*＃\*。如果您的手机允许，它应该打开诊断屏幕，您可以在其中检查移动连接的状态和类型，电池信息等。

## 3G 技术的演化
在 3G 网络的上下文中，我们分别有 3GPP 和 3GPP2 开发的两个主流并相互竞争的标准：UMTS 和基于 CDMA 的网络。然而，如之前的移动网络标准表（表7-3）所示，每个标准也分为几个过渡阶段：3.5G，3.75G 和 3.9G 技术。

为什么我们不能简单地跳到 4G 呢？指定标准需要很长时间，更重要的是，部署新的网络基础架构的成本很高。正如我们看到的那样，相比 3G，4G 需要一个完全不同的无线电接口和并行的基础设施。由于这个原因，并且为了许多购买了 3G 手机的用户的利益，3GPP 和 3GPP2 都不断发展现有的 3G 标准，这也使运营商能够逐步升级其现有网络，使用户有更好的体验。

毫不奇怪的是每个 3G 网络的新版本在吞吐量，延迟和其他性能特征都会有所改善。其实在技术上，LTE 被认为是3.9G的过渡标准！然而，在我们进入LTE之前，让我们仔细看看各种 3GPP 和3GPP2 发展过程中的里程碑。

## 3GPP 技术演进

发布版本|日期|总结
---|---|
99|1999|第一版 UMTS 标准
4|2001|引入全IP核心网
5|2002|引入高速下行分组接入(HSDPA)
6|2004|引入高速上行分组接入(HSUPA)
7|2007|引入增强型高速分组接入(HSPA+)
8|2008|引入新的增强型 LTE 系统架构(SAE)
9|2009|Improvements to SAE and WiMAX interoperability
10|2010|引入 4G 高级 LTE 架构

表 7-4 3GPP 发布历史

在遵循 3GPP 标准的情况下，HSDPA 和 HSUPA 版本的组合通常被称为高速分组接入网络（HSPA）。这两个版本的组合在现实世界中实现了低位的单位数 Mbit/s 吞吐量，这从早期的 3G 速度迈出了重要的一步。HSPA 网络通常被标记为3.5G。

这之后的下一个升级是 HSPA+ (3.75G)。在实际的部署中，由于核心网络架构的简化，显著降低了网络延迟并达到了 Mbit/s 的传输速率。然而正如我们看到的那样，引入 HSPA+ 的第七个发布版本并不是科技发展的终点。实际上，HSPA+ 标准在不不断改进，现在正与 LTE 和 LTE-advanced 正面交锋。

## 3GPP2 技术演进

Release|Date|Summary
---|---|
Rel.0|1999|第一次发布 1x EV-DO 标准
Rev.A|2001|提升峰值速率，降低延迟，引入 QoS
Rev.B|2004|引入多载波
Rev.C|2007|提升核心网络效率和性能

表 7-5 3GPP2 CDMA2000 1x EV-DO 标准的发布历史

3GPP2 开发的 CDMA2000 EV-DO 标准遵循了相似的网络升级路线。发布的第一个版本 (Rel. 0) 支持以 Mbit/s 计算的下行速率，但是上行速率很低。上行线路的速度问题由 Rev. A 解决，并且 Rev. B 同时提升了上下行的速率。因此 Rev. B 可以为用户提供 Mbit/s 的性能，这使得它可以和 HSPA 以及早期的 HSPA+ 或者说 3.5-3.75G  相比.

Rev. C 也是一个经常被提及的 EV-DO Advanced 发布版本，它提供了容量和性能方面的显著提升。然而，为什么目前采用的 EV-DO Advanced 并没有接近 HSPA+ 的水平呢？ 如果你仔细观察标准发展表（表 7-3）的话，你会发现 3GPP2 并没有官方的有竞争力的 4G 标准。

尽管 3GPP2 还在不断发展它的 CDMA 技术，在某一时刻，网络运营商和网络供应商都同意使用 3GPP LTE 作为所有网络的共同的 4G 后继。因此，许多 CDMA 网络运营商开始投资早期 LTE 基础设施，部分是为了能够继续进行 HSPA+ 的提升。

换句话说，世界上大多数移动网络运营商均将 HSPA+ 和 LTE 作为未来无线移动网络的标准，这是一个好消息。话虽如此，不要放松警惕。现存的 2G 和 3–3.75G 技术仍然主导了已经部署好了的移动无线网络，并且至少仍将继续运行十几年。

**note**

> 3G 经常被称作 “宽频移动”。然而，宽频是一个相对的概念。3G 通常被称为“移动宽带”。然而，宽带是一个相对的术语。有些人认为通信带宽超过 256 Kbit/s 才能被称作宽带，还有人认为应该超过 640 Kbit/s，但事实是，值会根据我们的经验而不断变化。随着服务的发展和需求的提高，宽带的定义也将越来越高。
>
> 在这方面，将 3G 标准视为超过 Mbit/s 的带宽阈值可能会更有用。 Mbit/s 的屏障有多远？这取决于标准的发布版本（如前所述），网络的运营商配置以及正在使用的设备的功能。


## IMT-Advanced 4G 需求
在我们深入分析各种 4G 技术之前，理解 “4G” 背后的意义是十分重要的。和 3G 一样，4G 不代表具体的技术，相反，4G 是国际电联在 2008 年开发并公布的一系列的需求（IMT-Advanced）。任何一个符合要求的技术都可以被称作 4G。

IMT-Advanced 的一些示例要求包括：

1. 基于 IP 数据包的交换网络
2. 与之前的无线标准兼容（3G 和 2G）
3. 移动客户端的速率达到 100 Mbit/s，静止时达到 Gbit/s+
4. 控制面延时小于 100 ms，用户面延时小于 10 ms
5. 用户间共享并动态分配网络资源
6. 5 - 20 MHZ 的带宽分配

真实的列表远比上述列表长的多，但是上述列表抓住了我们讨论的重点：相比之前的网络，更高的吞吐和显著降低的延迟。有了这些标准，我们现在知道了如何区分 4G 网络，是么？不，那么快，这就太简单了些！市场营销部门有些话要说。

LTE-Advanced 是为了满足所有 IMT-Advanced 要求所开发的标准。实际上，这也是第一个这样做的 3GPP 标准。如果您足够关注的话，您会注意到 LTE（第 8 版）和LTE-Advanced（第 10 版）实际上是不同的标准。在技​​术上，LTE 应该是一个 3.9G 的过渡标准，尽管它为了满足 4G 的要求做了很多必要的基础工作，但并没有满足所有的要求！

然而，这就是营销步骤。3G 和 4G 商标由国际电联持有，因此它们的使用应符合每一代的定义要求。然而运营商用一系列十分接近 4G 要求的技术进行营销政变并取得了胜利，重新定义了 “4G” 商标。因此，不符合 4G 技术要求的 LTE（第8版）和大多数 HSPA+ 网络仍然是“4G”。

那真正的（LTE-Advanced）4G 部署状况如何呢？即将到来但是还有待观察这些网络将如何利用之前的网络进行销售。无论如何，重要的是许多运营商今天使用的 “4G” 标签是不明确的，您应该阅读并了解其背后的技术。


## 长期演进技术（LTE）

尽管 3G 标准不断发展，但是不断增加的对高数据传输速度和较低延迟的需求暴露了早期的 UMTS 技术中一些固有的设计限制。为了解决这个问题，3GPP 开始重新设计核心和无线电网络，这导致了长期演进（LTE）标准的创建：

1. 全 IP 核心网
2. 简化网络架构
3. 控制面延时小于 100 ms，用户面延时小于 10 ms
4. 新的无线接口和高吞吐量调制（100 Mbps）
5. 能够使用更大的带宽分配和载波聚合
6. MIMO作为所有设备的要求

上述列表于我们之前看到的 IMT-Advanced 要求相似丝毫不令人感动奇怪。 LTE（第8版）为新的网络架构奠定了基础，LTE-Advanced（第 10 版）提供了必要的改进以满足 IMT-Advanced 规定的真正 4G。

在这一点上需要特别注意的是，由于无线电与核心网络之间实现的差异，LTE 网络并不是对现有 3G 基础架构的简单升级。相反，LTE 网络必须与现有的 3G 基础设施并行部署并分开。然而，由于 LTE 是 UMTS 和 CDMA 标准的常见后继，它确实提供了一种与两者进行交互的方式：LTE 用户可以无缝地切换到 3G 网络，并在 LTE 基础设施可用的情况下进行迁移。

最后，顾名思义，LTE 绝对是几乎所有未来移动网络的长期演进计划。唯一的问题是这个未来有多远。一些运营商已经开始投资 LTE 基础设施建设，许多其他运营商正在开始寻找频谱与资金。然而目前的行业估计显示，这一迁移确实需要很长的时间 - 也许在未来十年左右。同时，HSPA+ 将占领舞台中央。

**note**

> 每个支持 LTE 的设备必须具有多个用于支持 MIMO 的天线。然而，每个设备还将需要单独的无线电接口用于支持早期 3G 和 2G 网络。如果你数一数的话，那每个手机可以转换成三到四个收音机！对于 LTE 的更高的数据速率，您将需要 4xMIMO，总共可以有五到六个天线。你想知道为什么你的电池这么快消耗么？

## 引领世界采用 4G 的 HSPA+

2007 年发布的第七个版本的 3GPP 首次引入了 HSPA+。然而，尽管主流的注意力迅速向 2008 年第三季度首次推出的 LTE 转移，但是人们往往忽视了 HSPA+ 的发展并没有停止，它继续和 LTE 并行发展。实际上，版本 10 的 HSPA+ 符合许多 IMT-Advanced 标准。但是，您可能会问，如果我们有了 LTE，并且每个人都认可这是未来移动网络的标准，那为什么要继续开发和投资 HSPA+ 呢？像通常一样，答案仅仅是因为成本。

成本效益是目前工业界大多采用 HSPA+ 用于向 4G 升级（图7-2）。与此同时，3GPP2 开发的 CDMA 技术将继续共存，尽管预计它数量将开始缓慢下滑，而部署新的 LTE 将在不同地区以不同速率并行进行，一部分是由于成本限制，另一部分与由于所需无线电频谱不能使用。

![7-2](assets/2017-07-25-22-55-29.png)

图 7-2 HSPA+ 和 LTE 在北美的趋势预测

出于各种原因，北美是采用 LTE 的领导者：目前的行业预测显示，美国和加拿大的 LTE 用户数量在 2016 年超过了HSPA（图7-3）。然而，北美 LTE 采用率似乎比其他大多数国家显得更为激进。在全球范围内，HSPA+ 将成为当前十年主流的移动无线技术。

![](assets/2017-07-25-23-01-46.png)

图 7-3 北美地区：美国和加拿大  HSPA+ 和 LTE 的增长预测

**Note**

> 虽然许多人最初会对采用 HSPA+ 与 LTE 的趋势感到惊讶，但这并不是无法预测的结果。它可以说明重要的一点：从新的无线标准的第一个规范到实际可用的主流无线网络大约需要十年时间。
>
> 预测一下，到 21 世纪 20 年代早期，我们将会认真谈论 LTE-Advanced！不幸的是，部署新的无线电基础设施是一项昂贵而耗时的建议。

## 建设多代并存的未来

水晶球凝视是我们行业一个危险的做法。然而到目前为止，我们已经足以对现有的移动网络以及几年后的可能做出合理的预测。

首先，无线标准正在迅速发展，但这些网络的部署既费钱又耗时。此外，网络一旦部署，必须长期运行来收回成本，并保持现有的在线用户数量。换句话说，虽然在 4G 经过了大量的炒作和营销，但是老一代网络仍将运行十年以上。移动网络的建设需要相应规划。

**Note**

> 具有讽刺意味的是，虽然 4G 网络显着改进了 IP 数据传输，但 3G 网络在处理老式语音流量方面仍然更有效率！ 旨在通过 4G 实现高效可靠的语音传输的 LTE 语音技术（VoLTE）目前正在积极发展，但目前的大部分 4G 网络仍然依靠较旧的电路交换基础设施进行语音传送。

因此，当构建移动应用程序时，我们无法针对单一类型或一代的网络，或者更糟的是，无法获知具体的吞吐或延迟性能。正如我们所看到的那样，任何网络的实际性能都是随着部署版本，基础设施，无线电环境等十几个因素高度可变的。我们的应用程序应该适应网络中不断变化的条件：吞吐，延迟甚至无线连接的可用性。用户随时随地可以根据可用的覆盖范围和信号强度在多代网络（LTE，HSPA +，HSPA，EV-DO，甚至 GPRS Edge）之间进行转换。如果应用程序无法解决这个问题，那么就会影响到用户体验。

好消息是 HSPA+ 和 LTE 的采用率增长的非常快，这使得全新的高吞吐和延迟敏感型应用成为了可能。两者在吞吐量和延迟方面都有了显著的提升（表7-6）：真实环境中数 Mbps 的吞吐量，以及 100 毫秒的延迟使得它们与许多家庭和办公室的 WiFi 网络相当。

  项目|HSPA+|LTE|LTE-Advanced
  ---|---|---|---
峰值上行速率(Mbit/s) | 168 | 300 | 3,000
峰值下行速率(Mbit/s) | 22 | 75 | 1,500
最大 MIMO 流 | 2 | 4 | 8
理想连接延迟(ms) | < 100 | < 100 | < 50
激活延迟(ms) | < 50 | < 50 | < 10
用户面单路延迟(ms) | < 10 | < 5 | < 5

表 7-6 HSPA+, LTE, 与 LTE-Advanced 之间对比

虽然 4G 无线性能通常可以与 WiFi 或有线宽带相比，但我们不可以将它们视为相同的环境，它们绝对不同。

例如，大多数用户和开发人员期望设备永久连接到互联网，并随时对用户输入或输入数据包进行即时反应。这个假设在有线的世界中成立，但对于移动网络绝对不正确。实际情况的限制，如电池寿命和设备能力意味着我们必须根据移动网络的限制来设计我们的应用程序。让我们深入一下这些差异。

> 用户面单路延迟
>
> 用户面单向延迟是由 LTE 标准规定的用于无线设备中可用分组与无线电塔相同的可用分组之间的单向传输所需的时间。换句话说，当设备处于高功率连续接收状态时，它意味着无线传输第一跳的单向延迟。每个应用包都会产生这个开销，没有简化方式。


# 设备特性和功能
人们经常忘记掉部署无线电网络只是方程的一边。毫无疑问的是，不同制造商和发布日期的设备的特性往往不同：CPU 速度与核心数量，可用内存大小，存储容量，GPU等。这些因素都将影响设备与应用程序的整体性能。

然而当涉及到网络性能时，即使考虑了所有的变量，还有一个部分经常被忽略掉：无线电功能。具体来说，用户手持的设备必须能够利用完成部署的无线电基础设施！运营商可以部署最新的 LTE 基础架构，但是为早期版本设计的设备可能根本无法使用它，反之亦然。
